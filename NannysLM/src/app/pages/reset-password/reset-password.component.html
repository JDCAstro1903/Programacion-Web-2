<div class="reset-password-container">
  <!-- Sección izquierda - Promocional -->
  <div class="promo-section">
    <div class="promo-content">
      <h1>Seguridad en tu cuenta</h1>
      <p>Protege tu cuenta con una contraseña fuerte y única. Tu seguridad es nuestra prioridad.</p>
    </div>
    <button class="back-button" (click)="goToLogin()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>

  <!-- Sección derecha - Formulario -->
  <div class="form-section">
    <div class="form-container">

      <!-- PASO 1: Formulario de contraseña -->
      <div *ngIf="step === 'form'" class="form-content">
        <div class="header">
          <h2>Crea una nueva contraseña</h2>
          <p class="subtitle">Asegúrate de crear una contraseña segura y fácil de recordar</p>
        </div>

        <form (ngSubmit)="submitResetPassword()" class="password-form">
          
          <!-- Primera contraseña -->
          <div class="input-group">
            <label for="password">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                <path d="M7 11V7C7 4.239 9.239 2 12 2C14.761 2 17 4.239 17 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Nueva contraseña
            </label>
            <div class="password-input-wrapper">
              <input 
                [type]="showPassword ? 'text' : 'password'" 
                id="password" 
                [(ngModel)]="password" 
                (input)="validatePasswordStrength()"
                name="password"
                placeholder="Ingresa tu nueva contraseña"
                autocomplete="new-password">
              <button type="button" class="toggle-password" (click)="togglePasswordVisibility()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path *ngIf="!showPassword" d="M12 5C5 5 1 12 1 12S5 19 12 19S23 12 23 12S19 5 12 5M12 15C13.657 15 15 13.657 15 12C15 10.343 13.657 9 12 9C10.343 9 9 10.343 9 12C9 13.657 10.343 15 12 15Z" fill="currentColor"/>
                  <path *ngIf="showPassword" d="M1 12S5 5 12 5S23 12 23 12S19 19 12 19S1 12 1 12M12 16C14.209 16 16 14.209 16 12C16 9.791 14.209 8 12 8C9.791 8 8 9.791 8 12C8 14.209 9.791 16 12 16M12 14C10.895 14 10 13.105 10 12C10 10.895 10.895 10 12 10C13.105 10 14 10.895 14 12C14 13.105 13.105 14 12 14Z" fill="currentColor"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Barra de fuerza de contraseña -->
          <div *ngIf="password" class="strength-meter">
            <div class="strength-bar">
              <div class="strength-fill" [style.width.%]="passwordStrength" [style.background-color]="getStrengthColor()"></div>
            </div>
            <p class="strength-text" [style.color]="getStrengthColor()">
              Fuerza: <strong>{{ getStrengthText() }}</strong>
            </p>

            <!-- Requisitos -->
            <div class="requirements">
              <div class="requirement" [class.met]="passwordRequirements.length">
                <span class="check">✓</span>
                <span>Mínimo 6 caracteres</span>
              </div>
              <div class="requirement" [class.met]="passwordRequirements.uppercase">
                <span class="check">✓</span>
                <span>Una letra mayúscula (A-Z)</span>
              </div>
              <div class="requirement" [class.met]="passwordRequirements.lowercase">
                <span class="check">✓</span>
                <span>Una letra minúscula (a-z)</span>
              </div>
              <div class="requirement" [class.met]="passwordRequirements.number">
                <span class="check">✓</span>
                <span>Un número (0-9)</span>
              </div>
            </div>
          </div>

          <!-- Confirmar contraseña -->
          <div class="input-group">
            <label for="confirmPassword">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                <path d="M7 11V7C7 4.239 9.239 2 12 2C14.761 2 17 4.239 17 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Confirmar contraseña
            </label>
            <div class="password-input-wrapper">
              <input 
                [type]="showConfirmPassword ? 'text' : 'password'" 
                id="confirmPassword" 
                [(ngModel)]="confirmPassword" 
                name="confirmPassword"
                placeholder="Confirma tu nueva contraseña"
                autocomplete="new-password">
              <button type="button" class="toggle-password" (click)="toggleConfirmPasswordVisibility()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path *ngIf="!showConfirmPassword" d="M12 5C5 5 1 12 1 12S5 19 12 19S23 12 23 12S19 5 12 5M12 15C13.657 15 15 13.657 15 12C15 10.343 13.657 9 12 9C10.343 9 9 10.343 9 12C9 13.657 10.343 15 12 15Z" fill="currentColor"/>
                  <path *ngIf="showConfirmPassword" d="M1 12S5 5 12 5S23 12 23 12S19 19 12 19S1 12 1 12M12 16C14.209 16 16 14.209 16 12C16 9.791 14.209 8 16 8C9.791 8 8 9.791 8 12C8 14.209 9.791 16 12 16M12 14C10.895 14 10 13.105 10 12C10 10.895 10.895 10 12 10C13.105 10 14 10.895 14 12C14 13.105 13.105 14 12 14Z" fill="currentColor"/>
                </svg>
              </button>
            </div>

            <!-- Validación de coincidencia -->
            <div *ngIf="confirmPassword && password !== confirmPassword" class="error-feedback">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
                <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
              </svg>
              Las contraseñas no coinciden
            </div>
            <div *ngIf="confirmPassword && password === confirmPassword" class="success-feedback">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Las contraseñas coinciden
            </div>
          </div>

          <!-- Mensaje de error -->
          <div *ngIf="message" class="alert alert-error">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <line x1="15" y1="9" x2="9" y2="15" stroke="currentColor" stroke-width="2"/>
              <line x1="9" y1="9" x2="15" y2="15" stroke="currentColor" stroke-width="2"/>
            </svg>
            {{ message }}
          </div>

          <!-- Botón de envío -->
          <button 
            type="submit" 
            class="submit-button"
            [disabled]="isLoading || !isPasswordValid()">
            <span *ngIf="!isLoading">Restablecer contraseña</span>
            <span *ngIf="isLoading" class="loading-content">
              <svg class="spinner" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-dasharray="15.7 47.1"/>
              </svg>
              Restableciendo...
            </span>
          </button>
        </form>

        <div class="footer-links">
          <p>¿Recuerdas tu contraseña?</p>
          <a class="link" (click)="goToLogin()">Volver al login</a>
        </div>
      </div>

      <!-- PASO 2: Cargando -->
      <div *ngIf="step === 'loading'" class="form-content loading-view">
        <div class="loading-icon-wrapper">
          <svg class="spinner-large" width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="#1EB2E5" stroke-width="2" stroke-dasharray="15.7 47.1"/>
          </svg>
        </div>
        <h2>Restableciendo contraseña...</h2>
        <p>Por favor espera mientras procesamos tu solicitud</p>
      </div>

      <!-- PASO 3: Éxito -->
      <div *ngIf="step === 'success'" class="form-content success-view">
        <div class="success-icon-wrapper">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" fill="#10B981" stroke="#10B981" stroke-width="2"/>
            <path d="M9 12L11 14L15 10" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>

        <div class="success-content">
          <h2>¡Contraseña actualizada!</h2>
          <p>Tu contraseña ha sido restablecida correctamente.</p>

          <div class="success-info">
            <p>Serás redirigido al login en unos momentos.</p>
            <p class="small-text">Si no eres redirigido automáticamente:</p>
            <a class="link" (click)="goToLogin()">Haz clic aquí para ir a login</a>
          </div>
        </div>
      </div>

      <!-- PASO 4: Error -->
      <div *ngIf="step === 'error'" class="form-content error-view">
        <div class="error-icon-wrapper">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" fill="#EF4444" stroke="#EF4444" stroke-width="2"/>
            <line x1="15" y1="9" x2="9" y2="15" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
            <line x1="9" y1="9" x2="15" y2="15" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
          </svg>
        </div>

        <div class="error-content">
          <h2>Oops, algo salió mal</h2>
          <p>{{ message }}</p>

          <div class="error-actions">
            <button class="primary-button" (click)="goToForgotPassword()">Solicitar nuevo enlace</button>
            <button class="secondary-button" (click)="goToLogin()">Volver a login</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
