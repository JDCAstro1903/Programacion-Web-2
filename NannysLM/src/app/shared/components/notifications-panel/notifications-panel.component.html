<!-- Header -->
<div *ngIf="showHeader" class="notifications-header">
  <h3 class="notifications-title">
    Notificaciones
    <span class="notifications-count">
      ({{ getTotalCount() }})
    </span>
  </h3>
</div>

<!-- Filtros -->
<div *ngIf="showFilters" class="notifications-filters" role="group" aria-label="Filtros de notificaciones">
  <button 
    type="button"
    (click)="notificationsView = 'unread'"
    [attr.aria-pressed]="notificationsView === 'unread'"
    [class.active]="notificationsView === 'unread'"
    class="filter-btn">
    <span class="filter-text-full">No Leídas ({{ getUnreadCount() }})</span>
    <span class="filter-text-short">No Leídas</span>
    <span class="filter-badge">{{ getUnreadCount() }}</span>
  </button>
  <button 
    type="button"
    (click)="notificationsView = 'all'"
    [attr.aria-pressed]="notificationsView === 'all'"
    [class.active]="notificationsView === 'all'"
    class="filter-btn">
    <span class="filter-text-full">Todas ({{ getTotalCount() }})</span>
    <span class="filter-text-short">Todas</span>
    <span class="filter-badge">{{ getTotalCount() }}</span>
  </button>
</div>

<!-- Estado de carga -->
<div *ngIf="isLoadingNotifications" class="loading-container">
  <div class="loading-spinner"></div>
  <p>Cargando notificaciones...</p>
</div>

<!-- Lista de notificaciones -->
<div *ngIf="!isLoadingNotifications" class="notifications-list" role="feed" aria-label="Lista de notificaciones">
  <!-- Sin notificaciones -->
  <div *ngIf="getFilteredNotifications().length === 0" class="empty-state">
    <p>
      {{ notificationsView === 'unread' ? 'No hay notificaciones sin leer' : 'No hay notificaciones' }}
    </p>
  </div>

  <!-- Notificaciones -->
  <article #notificationCard
    *ngFor="let notification of getFilteredNotifications()" 
    [attr.role]="'article'"
    [attr.aria-label]="notification.title"
    [class.is-read]="notification.is_read"
    class="notification-card"
    [style.border-left-color]="getNotificationColor(notification.type)"
    (click)="handleNotificationClick(notification)"
    (mouseenter)="onNotificationMouseEnter(notificationCard)"
    (mouseleave)="onNotificationMouseLeave(notificationCard)">
    
    <div class="notification-content">
      <div class="notification-main">
        <!-- Título -->
        <h4 class="notification-title">
          {{ notification.title }}
          <span *ngIf="!notification.is_read" 
            class="sr-only" 
            aria-label="no leída">
            (sin leer)
          </span>
        </h4>
        
        <!-- Mensaje -->
        <p class="notification-message">
          {{ notification.message }}
        </p>
        
        <!-- Fecha y estado -->
        <div class="notification-meta">
          <time [dateTime]="notification.created_at" class="notification-date">{{ formatDate(notification.created_at) }}</time>
          <span *ngIf="!notification.is_read" 
            class="unread-indicator" 
            title="No leída"
            role="status"
            aria-label="notificación no leída"></span>
        </div>
      </div>

      <!-- Botones de acción -->
      <div class="notification-actions" role="toolbar" aria-label="Acciones">
        <button 
          *ngIf="!notification.is_read"
          type="button"
          (click)="markNotificationAsRead(notification, $event)"
          title="Marcar como leída"
          aria-label="Marcar como leída"
          class="action-btn read-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <polyline points="20 6 9 17 4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="btn-text">Leer</span>
        </button>
        <button 
          type="button"
          (click)="deleteNotification(notification.id, $event)"
          title="Eliminar"
          aria-label="Eliminar notificación"
          class="action-btn delete-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <polyline points="3 6 5 6 21 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="10" y1="11" x2="10" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="14" y1="11" x2="14" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span class="btn-text">Eliminar</span>
        </button>
      </div>
    </div>
  </article>
</div>

<!-- Estilos globales -->
<style>
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>